# 抖音火花助手

一个用于抖音创作者后台的自动化工具，帮助用户管理聊天列表并自动发送消息以维持"火花"关系。

## 功能特性

- **自动抓取聊天列表**：自动获取抖音创作者后台的聊天列表到暂存区
- **续火花目标管理**：支持将聊天对象添加为续火花目标，并设置个性化模板
- **模板系统**：支持变量替换（$date、$targetName、$sinceDate()）和简单条件语句
- **宏管理系统**：强大的宏管理功能，支持创建、编辑、启用/禁用宏，并可将宏分配给特定模板
- **批量发送**：支持选中多个对象批量发送消息
- **定时发送**：可设置每日定时发送消息给所有续火花目标
- **Monaco编辑器**：集成Monaco编辑器提供强大的代码编辑体验，支持语法高亮和自动补全
- **主题切换**：支持亮色/暗色主题切换，可跟随系统主题
- **界面可定制**：面板可拖动、调整大小和最小化

## 安装方法

1. 安装浏览器扩展：[Tampermonkey](https://www.tampermonkey.net/)
2. 点击Tampermonkey图标，选择"创建新脚本"
3. 删除默认内容，将`抖音火花助手.js`文件中的完整代码复制粘贴进去
4. 保存脚本（Ctrl+S）
5. 访问抖音创作者后台的聊天页面：https://creator.douyin.com/creator-micro/data/following/chat

## 使用说明

### 基本操作

1. **抓取聊天列表**：点击"抓取聊天"按钮，自动获取当前页面上的所有聊天对象到暂存列表
2. **添加续火花目标**：在暂存列表中，点击"添加目标"按钮将对象添加到续火花目标列表
3. **编辑模板**：点击"模板"按钮，为特定对象设置个性化消息模板
4. **启用宏**：在宏管理界面中，点击"启用"按钮启用特定宏，可以一次编写，到处使用
5. **发送消息**：点击"发送"按钮立即向该对象发送消息

### 模板系统

模板支持以下变量和语法：

- `$date`：当前日期
- `$targetName`：对方名称
- `$sinceDate("YYYY-M-D")`：计算从指定日期到现在的天数

示例模板：

```js
//该写法会跳过宏功能
return `$date $targetName 我们已经认识${$sinceDate("2023-1-1")}天了，继续保持火花！`;
```

```js
//该写法比较推荐
res="$date $targetName 我们已经认识${$sinceDate("2023-1-1")}天了，继续保持火花！";
```

```js
//该写法没有问题，但建议使用上面的写法
res=+="$date $targetName 我们已经认识${$sinceDate("2023-1-1")}天了，继续保持火花！";
```

```js
//如何自定义
res="自动续火花|$date"; //定义基础内容
res+="\n";
res+="$targetName 我们已经认识${$sinceDate("2023-1-1")}天了，继续保持火花！"; //新增内容

```

#### 运行原理：
```js
result=eval(`(function(){let res="";${out};${macroCode};return res;})()`)
```
- `out`：解析后的模板内容
- `macroCode`：经过解析后的宏内容
- `res`：模板的最终结果

### 宏系统(v1.0.1新增)
1. 在宏管理界面中，点击"新建宏"按钮创建新宏
2. 在编辑器中输入宏代码，使用JavaScript语法
3. 点击"保存"按钮保存宏
4. 在模板中，使用`macro("宏名称")`调用宏
5. 宏代码的操作对象为变量`res`，即模板的最终结果

#### 宏代码示例：
```js
//判断新年时间
// res为模板处理后的结果，由宏进行最后的处理，无需使用return
let t=$sinceDate("2026-2-17")*-1;
if(15<=t){
  res+="距离新年还剩"+t+"天";
}else if(0<t<15){
  res+="新年倒计时"+t+"天";
}else{
  res+="新年快乐！";
}

```

### 批量操作

1. 选中多个对象（使用复选框）
2. 点击"批量发送选中"按钮，依次向所有选中对象发送消息
3. 可设置每条消息之间的发送间隔时间

### 定时发送

1. 在底部设置区域，设置"定时发送"时间（格式：HH:MM）
2. 点击"保存并启用"按钮
3. 系统将在每天设定的时间自动向所有续火花目标发送消息

### 自动发送（v1.0.2新增）

## 高级功能

### Monaco编辑器

- 支持JavaScript语法高亮
- 自动补全内置变量
- 支持快捷键（Ctrl+S保存，Esc关闭）
- 可全屏编辑

### 界面定制

- 拖动面板标题栏可移动位置
- 拖动右下角可调整大小
- 点击"—"按钮可最小化面板
- 点击"主题"按钮可切换亮色/暗色主题

## 注意事项

- 本脚本仅在抖音创作者后台的聊天页面有效
- 发送消息间隔不宜过短，建议保持3秒以上间隔
- 请确保在发送消息前已正确登录抖音创作者后台

## 兼容性

- 支持Chrome、Firefox、Edge等主流浏览器
- 需要安装Tampermonkey或类似用户脚本管理器

## 更新日志


### v1.0.3 (2026-01-04)
- **修正了作者GitHub项目地址**：不小心写少了，我就说怎么死活进不去：
  `https://github.com/WordlMargin/DouyinFireTool`
  -------------------------------------------↓
  `https://github.com/WordlMargin2/DouyinFireTool`

### v1.0.2 (2026-01-03)
- **修复了一些已知问题**：
  - 修复了由于原来的eval函数内`let res`与一般逻辑:`res+=xxx`导致结果前出现undefined的问题；解决方案：将`let res`改为`let res=""`
  - 修复了由于默认模板`return xxx`导致的宏功能无法执行的问题；解决方案：将`return xxx`改为`res=xxx`

- **新增了一些功能**：
  - 新增了`自动发送选项`，选择该选项后将会在进入聊天页面时自动检查当天是否发送过消息，如果未发送则自动发送

### v1.0.1 (2026-01-02)
- **宏管理界面美化**：全面优化宏管理界面的视觉设计
  - 采用现代化渐变背景和增强的视觉层次
  - 改进悬停效果和交互反馈
  - 优化亮色/暗色主题适配
  - 增强滚动条和表单元素样式
  - 添加视觉指示器区分启用/禁用的宏
  - 改进宏列表和表单布局

### v1.0.0
- **初始版本发布**
- **自动抓取聊天列表**：自动获取抖音创作者后台的聊天列表到暂存区
- **续火花目标管理**：支持将聊天对象添加为续火花目标，并设置个性化模板
- **模板系统**：支持变量替换（$date、$targetName、$sinceDate()）和简单条件语句
- **批量发送**：支持选中多个对象批量发送消息
- **定时发送**：可设置每日定时发送消息给所有续火花目标
- **Monaco编辑器**：集成Monaco编辑器提供强大的代码编辑体验，支持语法高亮和自动补全
- **主题切换**：支持亮色/暗色主题切换，可跟随系统主题
- **界面可定制**：面板可拖动、调整大小和最小化

## 版本信息

- 当前版本：1.0.1
- 作者：WorldMargin

## 许可证

本项目仅供学习交流使用，请勿用于商业用途。使用本脚本所产生的任何后果由使用者自行承担。